<!DOCTYPE html>
<html>
<head>
<title>{{ problem[1] }}</title>
<link rel="stylesheet" href="/static/style.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>

<!-- ===== TOP BAR ===== -->

<div class="navbar">
    <h2>{{ problem[1] }}</h2>

    <a href="/dashboard">
        <button class="logout-btn" type="button">Back</button>
    </a>
</div>

<!-- ===== MAIN LAYOUT ===== -->

<div class="main">

    <!-- ===== LEFT PANEL ===== -->

    <div class="left-panel">

        <h2>Problem</h2>

        <p>{{ problem[2] }}</p>

    </div>

    <!-- ===== RIGHT PANEL ===== -->

    <div class="right-panel">

        <h3>ðŸ’» Code Editor</h3>

        <textarea id="code" placeholder="Write Python code here..."></textarea>

        <!-- CUSTOM INPUT -->

        <button type="button" onclick="toggleInput()">
            Custom Input
        </button>

        <div id="inputBox" style="display:none; margin-top:10px;">

            <h4>Input (for Run)</h4>

            <textarea id="stdin"
            placeholder="Example:
2
3"
            style="width:100%; height:100px;"></textarea>

        </div>

        <!-- BUTTONS -->

        <div class="buttons">

            <button type="button" onclick="runCode()">â–¶ Run</button>

            <button type="button" onclick="executeCode()">âš¡ Execute</button>

            <button type="button" onclick="submitCode()">ðŸš€ Submit</button>

        </div>

        <!-- OUTPUT -->

        <h3>Output</h3>

        <textarea id="output"
        readonly
        style="width:100%; height:160px; background:black; color:lime;"></textarea>

    </div>

</div>

<!-- ===== JAVASCRIPT ===== -->

<script>

// Toggle input box
function toggleInput(){
    const box = document.getElementById("inputBox");
    box.style.display = (box.style.display === "none") ? "block" : "none";
}

// ================= RUN =================

function runCode(){

    const code = document.getElementById("code").value;
    const stdin = document.getElementById("stdin").value;

    document.getElementById("output").value = "Running...";

    fetch("/run", {
        method: "POST",
        headers: {"Content-Type":"application/x-www-form-urlencoded"},
        body:
            "code=" + encodeURIComponent(code)
            + "&stdin=" + encodeURIComponent(stdin)
    })
    .then(r => r.text())
    .then(d => document.getElementById("output").value = d)
    .catch(err => document.getElementById("output").value = err);
}

// ================= EXECUTE =================

function executeCode(){

    const code = document.getElementById("code").value;

    document.getElementById("output").value = "Executing test cases...";

    fetch("/execute/{{ problem[0] }}", {
        method:"POST",
        headers: {"Content-Type":"application/x-www-form-urlencoded"},
        body: "code=" + encodeURIComponent(code)
    })
    .then(r=>r.text())
    .then(d=>document.getElementById("output").value = d)
    .catch(err=>document.getElementById("output").value = err);
}

// ================= SUBMIT =================

function submitCode() {

    const code = document.getElementById("code").value;

    document.getElementById("output").value = "Submitting...";

    fetch("/submit/{{ problem[0] }}", {
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        body: "code=" + encodeURIComponent(code)
    })
    .then(response => response.text())
    .then(data => {

        // Format: verdict|passed|total|next_id
        const parts = data.split("|");

        const verdict = parts[0];
        const passed = parts[1];
        const total = parts[2];
        const nextId = parts[3];

        const message = verdict + " â€” " + passed + "/" + total + " Passed";

        document.getElementById("output").value = message;

        // Remove old NEXT button if exists
        const oldBtn = document.getElementById("nextBtn");
        if (oldBtn) oldBtn.remove();

        // â­ Show NEXT button ONLY if Accepted
        if (verdict === "Accepted" && nextId && nextId !== "None") {

            const nextBtn = document.createElement("button");

            nextBtn.id = "nextBtn";
            nextBtn.innerText = "âž¡ Next Problem";
            nextBtn.className = "logout-btn";
            nextBtn.style.marginTop = "12px";

            nextBtn.onclick = function() {
                window.location.href = "/problem/" + nextId;
            };

            document.querySelector(".right-panel").appendChild(nextBtn);
        }

    })
    .catch(error => {
        document.getElementById("output").value = "Error: " + error;
    });
}

</script>

</body>
</html>